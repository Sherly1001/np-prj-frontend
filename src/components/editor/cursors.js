export const colors = [
  '--bs-blue',
  '--bs-indigo',
  '--bs-purple',
  '--bs-pink',
  '--bs-red',
  '--bs-orange',
  '--bs-yellow',
  '--bs-green',
  '--bs-teal',
  '--bs-cyan',
];

export const animals = [
  'Aardvark',
  'Aardwolf',
  'Abyssinian',
  'Addax',
  'Adelie Penguin',
  'Affenpinscher',
  'Afghan Hound',
  'African Bullfrog',
  'African Bush Elephant',
  'African Civet',
  'African Clawed Frog',
  'African Forest Elephant',
  'African Grey Parrot',
  'African Palm Civet',
  'African Penguin',
  'African Tree Toad',
  'African Wild Dog',
  'Aidi',
  'Ainu',
  'Airedale Terrier',
  'Airedoodle',
  'Akbash',
  'Akita',
  'Akita Shepherd',
  'Alabai',
  'Alaskan Husky',
  'Alaskan Klee Kai',
  'Alaskan Malamute',
  'Alaskan Shepherd',
  'Albacore Tuna',
  'Babirusa',
  'Baboon',
  'Bactrian Camel',
  'Badger',
  'Baiji',
  'Bald Eagle',
  'Baleen Whale',
  'Balinese',
  'Balkan Lynx',
  'Banana Ball Python',
  'Banana Spider',
  'Banded Palm Civet',
  'Banded Water Snake',
  'Bandicoot',
  'Banjo Catfish',
  'Cactus Mouse',
  'Caecilian',
  'Caiman',
  'Dachsador',
  'Dachshund',
  'Dalmadoodle',
  'Dalmador',
  'Dalmatian',
  'Dapple Dachshund',
  'Darwin’s fox',
  'Darwin’s Frog',
  'Deathwatch Beetle',
  'Deer',
  'Deer Head Chihuahua',
  'Desert Locust',
  'Eagle',
  'Earthworm',
  'Earwig',
  'Eastern Bluebird',
  'Eastern Chipmunk',
  'Eastern Fence Lizard',
  'Eastern Glass Lizard',
  'Eastern Gorilla',
  'Eastern Lowland Gorilla',
  'Eastern Phoebe',
  'Eastern Rat snake',
  'Echidna',
  'Falcon',
  'Fallow deer',
  'False Killer Whale',
  'False Widow Spider',
  'Fangtooth',
  'Feist',
  'Fennec Fox',
  'Ferret',
  'Ferruginous Hawk',
  'Fiddler Crab',
  'Field Spaniel',
  'Fila Brasileiro',
  'Fin Whale',
  'Finnish Spitz',
  'Fire salamander',
  'Fire-Bellied Toad',
  'Firefly',
  'Fish',
  'Gaboon Viper',
  'Galapagos Penguin',
  'Galapagos Tortoise',
  'Gar',
  'Garden Eel',
  'Garter Snake',
  'Gazelle',
  'Gecko',
  'Genet',
  'Gentoo Penguin',
  'Geoffroys Tamarin',
  'Gerberian Shepsky',
  'Gerbil',
  'German Pinscher',
  'German Shepherd Guide',
  'German Sheppit',
  'German Sheprador',
  'German Shorthaired Pointer',
  'German Spitz',
  'Gharial',
  'Ghost Crab',
  'Giant African Land Snail',
  'Giant Armadillo',
  'Giant Clam',
  'Macaroni Penguin',
  'Paddlefish',
  'Pademelon',
  'Painted Turtle',
  'Pangolin',
  'Panther',
  'Papillon',
  'Parakeet',
  'Parrot',
  'Parrotlet',
  'Parson Russell Terrier',
  'Patas Monkey',
  'Patterdale Terrier',
  'Peacock',
  'Peacock Butterfly',
  'Peacock Spider',
  'Peagle',
  'Peekapoo',
  'Pekingese',
  'Pelican',
  'Pembroke Welsh Corgi',
  'Penguin',
  'Pere Davids Deer',
  'Peregrine Falcon',
  'Perro De Presa Canario',
  'Persian',
  'Peruvian Inca Orchid',
  'Petit Basset Griffon Vendéen',
  'Petite Goldendoodle',
  'Pheasant',
  'Pied Tamarin',
  'Pig',
  'Pigeon',
  'Pika',
  'Pike Fish',
  'Pileated Woodpecker',
  'Pine Marten',
  'Pine Snake',
  'Pink Fairy Armadillo',
  'Piranha',
  'Pit Bull',
  'Pitador',
  'Pitsky',
  'Platypus',
  'Pocket Beagle',
  'Pocket Pitbull',
  'Pointer',
  'Poison Dart Frog',
  'Polar Bear',
  'Polish Lowland Sheepdog',
  'Polyphemus moth',
  'Pomapoo',
  'Pomchi',
  'Pomeagle',
  'Pomeranian',
  'Pomsky',
  'Pond Skater',
  'Poochon',
  'Poodle',
  'Poogle',
  'Pool Frog',
  'Porbeagle Shark',
  'Porcupine',
  'Porpoise',
  'Macaw',
  'Mackenzie Wolf',
  'Magellanic Penguin',
  'Maggot',
  'Magpie',
  'Maine Coon',
  'Malayan Civet',
  'Malayan Tiger',
  'Mallard',
  'Malteagle',
  'Maltese',
  'Maltese Shih Tzu',
  'Maltipoo',
  'Man of War Jellyfish',
  'Manatee',
  'Manchester Terrier',
  'Mandrill',
  'Maned Wolf',
  'Manta Ray',
  'Mantella Frog',
  'Rabbit',
  'Raccoon',
  'Raccoon Dog',
  'Radiated Tortoise',
  'Ragamuffin',
  'Ragdoll',
  'Raggle',
  'Rainbow Boa',
  'Rat',
  'Rat Terrier',
  'Rattlesnake',
  'Red Finch',
  'Red Fox',
  'Red Knee Tarantula',
  'Red Panda',
  'Red Squirrel',
  'Red Wolf',
  'Red-Eared Slider',
  'Red-handed Tamarin',
  'Red-winged blackbird',
  'Redback Spider',
  'Redbone Coonhound',
  'Reef Shark',
  'Reindeer',
  'Rhinoceros',
  'Ringed Kingfisher',
  'River Otter',
  'River Turtle',
  'Robin',
  'Rock Crab',
];

export function newCursorHTML(config, color) {
  let div = document.createElement('div');

  let name_top =
    config.top > config.height
      ? config.top - config.height
      : config.top + config.height;

  let style_color = color ? `color: ${color};` : '';
  div.innerHTML = `<div class="ace_multi_cursor"
    style="pointer-events: auto; width: 0; height: 0;"><div class="ace_cursor"
      style="${style_color}
        display: block;
        width: ${config.width}px; height: ${config.height}px;
        transform: translate(${config.left}px, ${config.top}px);
      "></div><span class="ace_multi_cursor_username"
      style="${style_color}
        position: absolute;
        transform: translate(${config.left}px, ${name_top}px);
        opacity: 0;
      ">${config.name}</span>
      </div>`
    .trim()
    .replace(/\s+/g, ' ');

  return div.firstChild;
}

export class CursorMaker {
  constructor(session, cursors) {
    this.session = session;
    this.cursors = cursors;
    this._elms = {};
  }

  update(_, markerLayer, session, config) {
    for (let id in this.cursors) {
      let pos = this.cursors[id];
      let screenPos = session.documentToScreenPosition(pos);

      let width = config.characterWidth;
      let height = config.lineHeight;
      let top = screenPos.row * height;
      let left = markerLayer.$padding + screenPos.column * width;
      let name = pos.username;

      let cfg = { width, height, top, left, name };
      let c = newCursorHTML(cfg, pos.color);
      c.onmouseenter = () => {
        c.children[1].style.opacity = 1;
      };
      c.onmouseleave = () => {
        c.children[1].style.opacity = 0;
      };

      if (this._elms[id]) {
        this._elms[id].remove();
        this._elms[id] = null;
      }

      markerLayer.elt(
        `ace_layer ace_cursor-layer ${
          pos.blink ? 'ace_animate-blinking' : 'ace_hidden-cursors'
        }`,
        ''
      );
      let parentNode =
        markerLayer.element.childNodes[markerLayer.i - 1] ||
        markerLayer.element.lastChild;

      parentNode.appendChild(c);
      this._elms[id] = c;
    }
  }

  redraw() {
    this.session._signal('changeFrontMarker');
  }

  addCursor(id, cursor) {
    cursor.blink == undefined && (cursor.blink = true);
    if (!cursor.color) {
      cursor.color = `var(${
        colors[Math.floor(Math.random() * colors.length)]
      })`;
    }
    if (!cursor.username) {
      cursor.username = `Random ${
        animals[Math.floor(Math.random() * animals.length)]
      }`;
    }

    let cr = this.cursors[id];
    if (cr) {
      cr.row = cursor.row;
      cr.column = cursor.column;
    } else {
      this.cursors[id] = cursor;
    }
  }

  removeCursor(name) {
    if (this._elms[name]) {
      this._elms[name].remove();
      delete this._elms[name];
    }
    delete this.cursors[name];
  }
}
